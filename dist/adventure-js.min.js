/*! adventure-js 05-11-2014 */
this.AventureGame=this.AdventureGame||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype=new createjs.Sprite;b.id=null,b.name=null,b.profile=null,b.marker=null,b.nextPosition=null,b.destinationCallback=null,b.moveDistance=5,b.inventory=null,b.baseHeight=null,b.baseWidth=null,b.Sprite_initialize=b.initialize,b.initialize=function(a){if(console.log(a),!a.id)throw"No ID set for character";if(!a.name)throw"No name set for character";if(!a.src)throw"No image source set";if(this.id=a.id,this.name=a.name,this.src=a.src,a.spritesheet)a.spritesheet.images=[this.src],this.baseHeight=a.spritesheet.frames.height,this.baseWidth=a.spritesheet.frames.width;else{var b=new Image(this.src);a.spritesheet={images:[this.src],frames:{width:b.width,height:b.height,count:1},animations:{idle:[0]}},this.baseHeight=b.height,this.baseWidth=b.width}var c=new createjs.SpriteSheet(a.spritesheet);if(console.log(c),this.Sprite_initialize(c),this.x=a.x?AdventureGame.getXCoord(a.x):0,this.y=a.y?AdventureGame.getYCoord(a.y):0,a.scale){var d=AdventureGame.getScaleToFit(a.scale,this);console.log(d),this.scaleX=d,this.scaleY=d}this.profile=a.profile||null,this.marker=a.marker||null,this.nextPosition=null,this.destinationCallback=null,a.moveDistance&&(this.moveDistance=a.moveDistance),this.inventory=a.inventory||new AdventureGame.Container({name:this.name+"'s Inventory",slots:5}),a.onClick&&(this.onClick=a.onClick),this.on("click",this.onClick),a.activate&&(this.activate=a.activate),this.gotoAndPlay("idle")},b.onClick=function(){var a;return AdventureGame.player?(AdventureGame.player.walkToPosition(this.x,this.y+this.getHeight()),AdventureGame.player.destinationCallback=this.activate,a=!0):a=this.activate(),a},b.activate=function(){return!0},b.getHeight=function(){return this.baseHeight*this.scaleY},b.getWidth=function(){return this.baseWidth*this.scaleX},b.getXLocation=function(){return this.x+this.getWidth()/2},b.getYLocation=function(){return this.y+this.getHeight()},b.setCharacterPosition=function(a,b){var c=this.getBounds();a&&(this.x=a-c.width/2),b&&(this.y=b-c.height)},b.walkToPosition=function(a,b){this.nextPosition={x:a,y:b},this.marker&&(this.marker.x=a,this.marker.y=a,AdventureGame.stage.hasChild(this.marker)||AdventureGame.stage.addChild(this.marker))},b.step=function(){if(null!==this.nextPosition){var a={x:this.getXLocation(),y:this.getYLocation()},b=a.x-this.nextPosition.x,c=a.y-this.nextPosition.y;b>0?(a.x=b>this.moveDistance?a.x-this.moveDistance:this.nextPosition.x,"left"!==this.currentAnimation&&(console.log("Animating left"),console.log("setting animation to left"),this.gotoAndPlay("left"))):0>b?(a.x=-b>this.moveDistance?a.x+this.moveDistance:this.nextPosition.x,"right"!==this.currentAnimation&&(console.log("setting animation to right"),this.gotoAndPlay("right"))):"idle"!==this.currentAnimation&&(console.log("setting animation to idle"),this.gotoAndPlay("idle")),c>0?a.y=c>this.moveDistance?a.y-this.moveDistance:this.nextPosition.y:0>c&&(a.y=-c>this.moveDistance?a.y+this.moveDistance:this.nextPosition.y),this.setCharacterPosition(a.x,a.y),a.x===this.nextPosition.x&&a.y===this.nextPosition.y&&(this.gotoAndPlay("idle"),console.log("At destination"),this.marker&&AdventureGame.stage.hasChild(this.marker.obj)&&AdventureGame.stage.removeChild(this.marker.obj),null!==this.destinationCallback&&(this.destinationCallback(),this.destinationCallback=null),this.nextPosition=null)}},AdventureGame.Character=a}(),this.AdventureGame=this.AdventureGame||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype;b.initialize=function(a){if(!a.name)throw"No name set for container";this.slots=a.numSlots||10,this.items=a.items||[],this.name=a.name,this.items.length>this.slots&&(this.slots=a.items.length);var b=0;for(b=0;b<this.items.length;b++)this.addItem(a.items[b])},b.addItem=function(a){var b,c=-1;if(!a instanceof AdventureGame.Item)throw console.log(a),"Invalid item";if(this.items.length<this.slots){for(b=0;b<this.items.length;b++)if(null===this.items[b])return console.log("Using inventory slot "+b),a.slot=b,this.items[b]=a,b;console.log("Using inventory slot "+b),a.slot=b,a.parentContainer=this,this.items[b]=a,c=b}else console.log("Container full");return c},b.removeItem=function(a){var b=-1,c=a.slot;return a.currentContainer===this&&this.items[a.slot]===a&&(this.items[a.slot]=null,a.currentContainer=null,a.slot=null,b=c),b},b.refresh=function(){console.log("To be implemented")},b.open=function(){var a,b,c,d,e;for(console.log("Opening container "+this.name),a=document.createElement("div"),a.id="container"+this.name,a.className="container",b=0;b<this.slots;b++)c=document.createElement("div"),c.id="container_slot_"+b,c.className="slot",a.appendChild(c),this.items.length>=b+1&&null!==this.items[b]&&(d=document.createElement("img"),d.src=this.items[b].image.src,c.appendChild(d),$(d).on("click",{item:this.items[b]},this.setClickHandler()));e=new AdventureGame.Dialog({text:"<h3>"+this.name+"</h3>",domContent:a}),e.show(),AdventureGame.stage.on("click",function(){})},b.setClickHandler=function(){return function(a){a.data.item.activate()}},AdventureGame.Container=a}(),this.AdventureGame=this.AdventureGame||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype;b.div=null,b.onClose=null,b.questionType=null,b.answers=null,b.initialize=function(a){console.log(a);var b,c,d,e,f,g,h,i,j,k,l=AdventureGame.stage;if(a.div)this.div=a.div.cloneNode(!0);else{if(this.div=document.createElement("div"),this.div.className="gamedialog",this.disableClose||(e=document.createElement("i"),e.className="fa fa-close fa-2x",$(e).on("click",this.close.bind(this)),this.div.appendChild(e)),a.image&&(b=document.createElement("div"),c=document.createElement("img"),b.className="dialogimage",c.src=a.image,b.appendChild(c),this.div.appendChild(b)),d=document.createElement("div"),d.className="dialogcontent",d.innerHTML=a.text,"radio"===a.question&&a.answers){for(this.questionType="radio",this.answers=[],f=document.createElement("form"),k="radio"+Date.now(),g=0;g<a.answers.length;g++)h=document.createElement("div"),h.className="radio",i=document.createElement("label"),j=document.createElement("input"),j.type="radio",j.name=k,j.className="inputElem",j.value=a.answers[g].value,i.appendChild(j),i.appendChild(document.createTextNode(a.answers[g].text)),h.appendChild(i),f.appendChild(h),a.answers[g].correct===!0&&this.answers.push(a.answers[g].value.toString());j=document.createElement("input"),j.type="button",j.value="OK",j.className="btn",$(j).on("click",this.evaluateAnswer.bind(this)),f.appendChild(j),d.appendChild(f)}a.domContent&&d.appendChild(a.domContent),this.div.appendChild(d)}this.div.style.width=.6*l.canvas.width+"px",this.div.style.left=.2*l.canvas.width+"px",this.div.style.top=.2*l.canvas.height+"px",this.div.style.maxHeight=.4*l.canvas.height+"px"},b.show=function(){var a,b=AdventureGame.stage;document.body.appendChild(this.div),a=$(this.div).height(),$(this.div).find(".dialogcontent").height(a),this.domElem=new createjs.DOMElement(this.div),b.addChild(this.domElem)},b.close=function(){AdventureGame.stage.removeChild(this.domElem),document.body.removeChild(this.div),this.onClose&&this.onClose()},b.evaluateAnswer=function(){this.close();var a,b,c=!1;if("radio"===this.questionType)for(a=this.div.getElementsByClassName("inputElem"),b=0;b<a.length;b++)if($(a[b]).is(":checked")){console.log(a[b]),console.log(this.answers),console.log($.inArray(a[b].value,this.answers)),$.inArray(a[b].value,this.answers)>=0&&(console.log("Correct"),c=!0);break}return c?this.correctCallback():this.incorrectCallback(),c},b.correctCallback=function(){var b=new a({image:this.image,text:"Correct"});b.show()},b.incorrectCallback=function(){var b=new a({image:this.image,text:"Sorry, that's incorrect"});b.show()},AdventureGame.Dialog=a}(),this.AdventureGame=this.AdventureGame||{},function(){"use strict";function a(a,b){return{x:AdventureGame.stage.canvas.width*(a/100),y:AdventureGame.stage.canvas.height*(b/100)}}function b(a,b){var c,d,g,h,i=a.match(e),j=a.match(f);if(d=b.getBounds?b.getBounds():{width:b.width,height:b.height},i){if(!AdventureGame.stage)throw"Unable to size item by percent as stage is not avilable";c=AdventureGame.stage.canvas,g=c.height*(parseInt(i[1],10)/100)/d.height,h=c.width*(parseInt(i[1],10)/100)/d.width}else{if(!j)throw"Invalid scale synatx";g=parseInt(i[1],10)/d.width,h=parseInt(i[1],10)/d.height}return h>g?g:h}function c(a){var b,c,d=a.match(e),g=a.match(f);if(d){if(!AdventureGame.stage)throw"Unable to size item by percent as stage is not avilable";b=AdventureGame.stage.canvas,c=b.width*(d[1]/100)}else{if(!g)throw"Invalid scale synatx";c=d[1]}return c}function d(a){var b,c,d=a.match(e),g=a.match(f);if(d){if(!AdventureGame.stage)throw"Unable to size item by percent as stage is not avilable";b=AdventureGame.stage.canvas,c=b.height*(d[1]/100)}else{if(!g)throw"Invalid scale synatx";c=d[1]}return c}var e=/(\d+\.?\d*)%/,f=/(\d+)px/;AdventureGame.stage=null,AdventureGame.player=null,AdventureGame.inputDisabled=!1,AdventureGame.flags={},AdventureGame.percentToStageCoord=a,AdventureGame.getScaleToFit=b,AdventureGame.getXCoord=c,AdventureGame.getYCoord=d}(),this.AdventureGame=this.AdventureGame||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype=Object.create(AdventureGame.GameBase.prototype);a.prototype.constructor=a,b.assets=null,b.currentRoom=null,b.loaded=!1,b.inventoryBoxsize=8,b.inventoryMarginsize=2,b.slotBoxes=[],b.playerData=null,b.GameBase_initialize=b.initialize,b.initialize=function(a){if(!a.stage)throw"Stage is not set";if(!a.player)throw"Player is not set";this.GameBase_initialize(a),AdventureGame.stage=a.stage,a.player instanceof AdventureGame.Character?AdventureGame.player=a.player:this.playerData=a.player,console.log("Seting up game"),this.assets={images:[],audio:[]},this.currentRoom=null,this.loaded=!1,this.inventoryBoxsize=8,this.inventoryMarginsize=2,this.slotBoxes=[]},b.loadRoom=function(a,b){AdventureGame.loadedGame=this,this.door=b||null,a instanceof AdventureGame.Room?this.loadRoomFromObject(a):this.loadRoomAssets(a)},b.loadRoomFromObject=function(a){console.log("Loading room from object"),console.log(a);var b=[],c=new createjs.LoadQueue;if(!a instanceof AdventureGame.Room)throw"Game cannot load room. Invalid parameter type";AdventureGame.player||(this.assets.images.playerImg=AdventureGame.player.image,b.push({src:AdventureGame.player.image.src,id:"playerImg"})),this.currentRoom=a,a.stage=this.stage,this.assets.images.roomBG={id:"roomBG"},b.push({src:a.background.image.src,id:"roomBG"}),c.on("progress",function(a){console.log("Loaded: "+a.loaded+"%")}),c.on("fileload",this.assetLoaded.bind(this)),c.on("complete",this.start.bind(this)),c.loadManifest(b),console.log(b),console.log(c),console.log("Loading items")},b.loadRoomAssets=function(a){var b,c,d=[],e=new createjs.LoadQueue;this.roomData=a,this.assets.images.roomBG={src:a.background},!AdventureGame.player&&this.playerData&&(this.assets.images.playerImg={src:this.playerData.src},d.push({src:this.playerData.src,id:"playerImg"})),d.push({src:a.background,id:"roomBG"});for(b in a.items)a.items.hasOwnProperty(b)&&(this.assets.images[b]={src:a.background},d.push({src:a.items[b].src,id:b}));for(c in a.characters)a.characters.hasOwnProperty(c)&&(console.log(a.characters[c]),this.assets.images[c]={src:a.characters[c].src},d.push({src:a.characters[c].src,id:c}));e.on("progress",function(a){console.log("Loaded: "+a.loaded+"%")}),e.on("fileload",this.assetLoaded.bind(this)),e.on("complete",this.start.bind(this)),e.loadManifest(d)},b.start=function(){var a,b,c,d,e=AdventureGame.player;e||(e=new AdventureGame.Character(this.playerData),AdventureGame.player=e);var f=this;if(AdventureGame.player.inventory.addItem=function(a){AdventureGame.Container.prototype.addItem.call(this,a),f.addToInventory(a)},this.roomData){a=this.roomData.items,this.roomData.items=[];for(b in a)a.hasOwnProperty(b)&&(this.roomData.items[b]=new AdventureGame.Item(a[b]));c=this.roomData.characters;for(d in c)c.hasOwnProperty(d)&&(this.roomData.characters[d]=new AdventureGame.Character(c[d]),console.log(this.roomData.characters[d]),console.log(this.assets));this.currentRoom=new AdventureGame.Room(this.roomData),this.door=this.roomData.entrance,this.roomData=null,console.log(this.currentRoom)}console.log("Fully loaded!"),e.hasEventListener("click")||e.addEventListener("click",e.onClick.bind("player")),this.currentRoom.load(AdventureGame.player,this.door),this.loaded=!0,this.showInventory(),this.tickerCallback=createjs.Ticker.addEventListener("tick",this.loop.bind(this))},b.loop=function(){this.loaded&&this.currentRoom&&this.currentRoom.loop(),AdventureGame.player.step(),this.stage.update()},b.showInventory=function(){var a=AdventureGame.player.inventory,b=this.stage,c=a.items.length,d=this.inventoryBoxsize/100*b.canvas.width,e=this.inventoryMarginsize/100*b.canvas.width,f=d*c+e*(c-1),g=(b.canvas.width-f)/2,h=g,i=0;for(i=0;c>i;i++)this.slotBoxes[i]=new createjs.Shape,this.slotBoxes[i].graphics.beginFill("rgba(255, 255, 255, 0.21)").beginStroke("black").setStrokeStyle(1).drawRoundRect(0,0,d,d,10),this.slotBoxes[i].x=h,this.slotBoxes[i].y=10,b.addChild(this.slotBoxes[i]),h=h+d+e},b.addToInventory=function(a){var b,c,d,e=this.stage,f=this.slotBoxes.length+1,g=this.inventoryBoxsize/100*e.canvas.width,h=this.inventoryMarginsize/100*e.canvas.width,i=g*f+h*(f-1),j=(e.canvas.width-i)/2,k=j,l=0;for(l=0;l<this.slotBoxes.length;l++)createjs.Tween.get(this.slotBoxes[l]).to({x:k},100),c=(g-a.getWidth())/2,createjs.Tween.get(AdventureGame.player.inventory.items[l]).to({x:k+c},100),k=k+g+h;this.slotBoxes[l]=new createjs.Shape,this.slotBoxes[l].graphics.beginFill("rgba(255, 255, 255, 0.21)").beginStroke("black").setStrokeStyle(1).drawRoundRect(0,0,g,g,10),this.slotBoxes[l].x=k,this.slotBoxes[l].y=10,this.slotBoxes[l].scaleX=0,this.slotBoxes[l].scaleY=0,e.addChild(this.slotBoxes[l]),b=.8*g,a.scale(b+"px"),c=(g-a.getWidth())/2,d=(g-a.getHeight())/2,a.x=k+c,a.y=this.slotBoxes[l].y+d,a.setDraggable(!0),e.addChild(a),createjs.Tween.get(this.slotBoxes[l]).to({scaleX:1,scaleY:1},100),k=k+g+h},AdventureGame.Game=a}(),this.AventureGame=this.AdventureGame||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype;b.initialize=function(a){if(!a.stage)throw"Stage is not set";this.stage=a.stage,AdventureGame.stage=this.stage,this.assets=a.assets||{images:[],audio:[]},a.setup&&(this.setup=a.setup),a.loop&&(this.setup=a.loop),a.exit&&(this.setup=a.exit),this.defaultSize=a.defaultSize||null,this.pageScale=1,this.defaultSize&&this.defaultSize.x&&(this.pageScale=this.stage.canvas.width/this.defaultSize.x),this.defaultSize&&this.defaultSize.y&&this.pageScale>this.stage.canvas.height/this.defaultSize.y&&(this.pageScale=this.stage.canvas.height/this.defaultSize.y),console.log(this.defaultSize),console.log("Page Scale: "+this.pageScale)},b.setup=function(){return this.tickerCallback=createjs.Ticker.addEventListener("tick",this.loop.bind(this)),!0},b.loop=function(){return this.stage.update(),!0},b.exit=function(){return createjs.Ticker.removeEventListener("tick",this.tickerCallback),this.stage.removeAllChildren(),!0},b.assetsToManifest=function(a){console.log(a);var b,c=[];for(b in a.images)a.images.hasOwnProperty(b)&&c.push({src:a.images[b].src,id:b});for(b in a.audio)a.audio.hasOwnProperty(b)&&c.push({src:a.audio[b].src,id:b});return c},b.assetLoaded=function(a){console.log("Loaded asset "+a.item.id);{var b=a.item,c=null;this.assets.images[a.item.id]}switch(b.type){case createjs.LoadQueue.IMAGE:this.assets.images[a.item.id].spritesheet?(c=new createjs.SpriteSheet({images:[b.src],frames:this.assets.images[a.item.id].frames,animations:this.assets.images[a.item.id].animations}),this.assets.images[a.item.id].loaded=!0,this.assets.images[a.item.id].obj=new createjs.Sprite(c,"idle"),this.assets.images[a.item.id].obj.scaleX=this.assets.images[a.item.id].scale,this.assets.images[a.item.id].obj.scaleY=this.assets.images[a.item.id].scale):(c=new Image,c.src=b.src,console.log(this.assets.images[a.item.id]),this.assets.images[a.item.id].loaded=!0,this.assets.images[a.item.id].obj=new createjs.Bitmap(c),this.assets.images[a.item.id].obj.scaleX=this.assets.images[a.item.id].scale,this.assets.images[a.item.id].obj.scaleY=this.assets.images[a.item.id].scale);break;case createjs.LoadQueue.AUDIO:throw"Audio files not yet supported";default:console.error("Unhandled file type: "+b.type)}},AdventureGame.GameBase=a}(),this.AdventureGame=this.AdventureGame||{},function(){"use strict";function a(a){if(!a.src)throw"No source set in image information";this.src=a.src,this.scale=void 0!==a.scale?a.scale:1,this.loaded=!1,this.obj=null,this.frames=a.frames||null,this.animations=a.animations||null,this.spritesheet=this.frames?!0:!1}a.prototype.getScaleForBox=function(a,b){var c,d;return c=a/this.obj.image.width,d=b/this.obj.image.height,c>d?d:c},AdventureGame.ImageInfo=a}(),this.AdventureGame=this.AdventureGame||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype=new createjs.Bitmap;a.prototype.constructor=a,b.id=null,b.name=null,b.description="",b.collecatable=!1,b.parentContainer=null,b.container=null,b.enabled=!0,b.Bitmap_initialize=b.initialize,b.initialize=function(a){if(!a.id)throw"No ID set for Item";if(!a.name)throw"No name set for item";if(!a.src)throw"Image source is not set";this.Bitmap_initialize(a.src),this.id=a.id,this.name=a.name,this.description=a.description||"",this.collectable=a.collectable||!1,this.parentContainer=a.parentContainer||null,a.onClick&&(this.onClick=a.onClick,this.on("click",this.onClick)),a.onDrop&&(this.onDrop=a.onDrop),a.activate&&(this.activate=a.activate),this.container=a.container||null,a.draggable&&this.setDraggable(!0),console.log("Scale: "+a.scale),a.scale&&(this.initialScale=a.scale,this.scale(a.scale)),a.x&&this.setX(a.x),a.y&&this.setY(a.y),this.on("mousedown",function(){this.lastLocation={x:this.x,y:this.y},this.enabled=!0})},b.onClick=function(){if(this.enabled)if(AdventureGame.player){var a=AdventureGame.player,b=this.getLocationonStage();a.walkToPosition(b.x,b.y+this.getHeight()),a.destinationCallback=this.activate}else this.activate()},b.onDrop=function(a){var b,c=!1,d=AdventureGame.stage.getObjectsUnderPoint(a.stageX,a.stageY);for(b=0;b<d.length;b++)d[b]!==this&&(c=c||d[b].activate(this));c||this.gotoLastLocation(),console.log(d)},b.activate=function(b){var c,d=!1,e=AdventureGame.player;return this.container?(null!==b&&b instanceof a&&this.container.addItem(b),this.container.open(),d=!0):b?d=!1:(c=new AdventureGame.Dialog({image:this.image.src,text:"<h3>"+this.name+"</h3><p>"+this.description+"</p>"}),c.show(),this.collectable&&e&&this.parentContainer!==e.inventory&&e.inventory.addItem(this),d=!0),d},b.addToContainer=function(a){this.parentContainer&&this.parentContainer.removeItem(this),this.parentContainer=a},b.getHeight=function(){return this.image.height*this.scaleY},b.getWidth=function(){return this.image.width*this.scaleX},b.setDraggable=function(a){a?(this.on("pressmove",this.itemDragged),this.on("pressup",this.onDrop),this.draggable=!0):this.draggable&&(this.off("pressmove",this.itemDragged),this.off("pressup",this.onDrop),this.draggable=!1)},b.itemDragged=function(a){this.enabled=!1,a.target.x=a.stageX-a.target.image.width*a.target.scaleX/2,a.target.y=a.stageY-a.target.image.height*a.target.scaleY/2},b.scale=function(a){if(!this.image)throw console.log(this),"Image is not yet loaded";a||(a=this.initialScale);var b,c,d,e=a.match(/(\d+)%/),f=a.match(/(\d+)px/);if(e){if(!AdventureGame.stage)throw"Unable to size item by percent as stage is not avilable";b=AdventureGame.stage.canvas,c=b.height*(e[1]/100)/this.image.height,d=b.width*(e[1]/100)/this.image.width,console.log(c+","+d),this.scaleX=d>c?c:d,this.scaleY=this.scaleX}else{if(!f)throw"Invalid scale synatx";console.log("Pixels"),c=f[1]/this.image.width,d=f[1]/this.image.height,this.scaleX=d>c?c:d,this.scaleY=this.scaleX}},b.setX=function(a){var b,c,d=a.match(/(\d+)%/),e=a.match(/(\d+)px/);if(d){if(!AdventureGame.stage)throw"Unable to size item by percent as stage is not avilable";b=AdventureGame.stage.canvas,c=b.width*(d[1]/100),this.x=c}else{if(!e)throw"Invalid scale synatx";console.log("Pixels"),this.x=d[1]}},b.setY=function(a){var b,c,d=a.match(/(\d+)%/),e=a.match(/(\d+)px/);if(d){if(!AdventureGame.stage)throw"Unable to size item by percent as stage is not avilable";b=AdventureGame.stage.canvas,c=b.height*(d[1]/100),this.y=c}else{if(!e)throw"Invalid scale synatx";console.log("Pixels"),this.y=d[1]}},b.gotoLastLocation=function(){createjs.Tween.get(this).to(this.lastLocation,100)},AdventureGame.Item=a}(),this.AdventureGame=this.AdventureGame||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype;b.background=null,b.floor=null,b.items=null,b.characters=null,b.doors=null,b.onLoad=null,b.onEnter=null,b.onExit=null,b.entered=null,b.initialize=function(a){if(!a.background)throw"Background not set for room";if(!a.floor)throw"Floor is not set for room";this.background=new createjs.Bitmap(a.background),this.floor=this.createFloor(a.floor),this.items=void 0!==a.items?a.items:{},this.characters=void 0!==a.characters?a.characters:{},this.doors=void 0!==a.doors?a.doors:{},this.onEnter=void 0!==a.onEnter?a.onEnter:function(){return!0},this.onLoad=void 0!==a.onLoad?a.onLoad:function(){return!0},this.onExit=void 0!==a.onExit?a.onExit:function(){return!0},this.entered=!1},b.createFloor=function(a){var b,c=new createjs.Shape;for(c.graphics.beginFill("rgba(255, 255, 255, 0.21)"),c.graphics.moveTo(a[0][0],a[0][1]),b=1;b<a.length;b++)c.graphics.lineTo(a[b][0],a[b][1]);return c.graphics.lineTo(a[0][0],a[0][1]),c.x=0,c.y=0,c},b.load=function(a,b){console.log("Loading room");var c,d,e,f,g=AdventureGame.stage,h=a.getHeight(),i=a.getWidth();this.background.scaleX=g.canvas.width/this.background.image.width,this.background.scaleY=g.canvas.height/this.background.image.height,g.addChild(this.background),this.floor.scaleX=this.background.scaleX,this.floor.scaleY=this.background.scaleY,g.addChild(this.floor),this.floor.on("click",function(b){a.walkToPosition(b.stageX,b.stageY),a.destinationCallback=null});for(c in this.items)this.items.hasOwnProperty(c)&&(this.items[c].room=this,g.addChild(this.items[c]));console.log(this.characters);for(d in this.characters)this.characters.hasOwnProperty(d)&&(e=this.characters[d],g.addChild(e));if(b)switch(f=AdventureGame.percentToStageCoord(b.x,b.y,AdventureGame.stage),console.log(AdventureGame.stage.canvas.width+" * ("+b.x+"/100)"),b.location){case"N":a.setCharacterPosition(f.x,f.y-5),a.nextPosition={x:f.x,y:f.y+h+5};break;case"E":a.setCharacterPosition(f.x-i+5,f.y),a.nextPosition={x:f.x+i+5,y:f.y};break;case"S":a.setCharacterPosition(f.x,f.y+h+5),a.nextPosition={x:f.x,y:f.y-5};break;case"W":a.setCharacterPosition(f.x-i-5,f.y),a.nextPosition={x:f.x+i+5,y:f.y};break;default:a.setCharacterPosition(f.x,f.y)}else a.setCharacterPosition(a.getXLocation(),a.getYLocation());g.addChild(a),g.update(),this.onLoad&&this.onLoad()},b.getPath=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=100,r=[],s=[],t=[],u=0,v=a,w=b,x=!1,y=!1;for(a-=a%q,b-=b%q,c-=c%q,d-=d%q,r[v]||(r[v]=[]),r[v][w]=u,s.push([v,w]);v!==c&&w!==d;){for(u=r[v][w],f=-1;1>=f;f++)for(g=-1;1>=g;g++){for(j=v+f,k=w+g,x=!1,h=AdventureGame.stage.getObjectsUnderPoint(j,k),i=0;i<h.length;i++)if(console.log(h[i]),-1===e.indexOf(h[i])){if(e[i]!==this.floor){x=!1;break}x=!0}if(x){if(r[j]||(r[j]=[]),void 0!==r[j][k]){for(y=!1,m=0;m<s.length;m++)if(s[m][0]===j&&s[m][1]===k){y=!0;break}y||t.push([j,k])}(!r[j][k]||r[j][k]<u+q)&&(r[j][k]=u+q)}}if(l=t.shift(),v=l[0],w=l[1],v===c&&w===d)break}for(n=[];v!==a&&w!==b;){for(n.shift([v,w]),o=v,p=w,f=-1;1>=f;f++)for(g=-1;1>=g;g++)j=v+f,k=w+g,r[j][k]<r[o][p]&&(o=j,p=k);v=o,w=p}return n},b.loop=function(){},AdventureGame.Room=a}();